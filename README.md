# Feedback App

[![pipeline status](https://gitlab.com/timmo/feedback-app/badges/master/pipeline.svg)](https://gitlab.com/timmo/feedback-app/commits/master)

[![Docker Version][version-shield]][microbadger]
[![Docker Layers][layers-shield]][microbadger]
[![Docker Pulls][pulls-shield]][dockerhub]

![Supports armhf Architecture][armhf-shield]
![Supports aarch64 Architecture][aarch64-shield]
![Supports amd64 Architecture][amd64-shield]
![Supports i386 Architecture][i386-shield]

Feedback application written in ReactJS

## Setup

### Docker Compose

---

- Install [Docker](https://www.docker.com/community-edition) and
 [Docker Compose](https://docs.docker.com/compose/install/)
- Create a directory for your compose file. For example, `feedback`
- Create a `docker-compose.yml` file:

#### SSL

> This example maps the `ssl` directory in the home directory.
> Inside this directory are two files `fullchain.pem` and `privkey.pem`
> which are files generated by [Let's Encrypt](https://letsencrypt.org/).
> Change the `TOKEN` environment variable to your own generated token

```yaml
---
version: '3'

services:
  app:
    image: timmo001/feedback-app
    restart: unless-stopped
    ports:
      - 443:443
    volumes:
      - ~/ssl:/ssl
  api:
    image: timmo001/feedback-api
    environment:
      CERTIFICATES_DIR: /ssl
      TOKEN: kZizIjt1fduiVqA68RuvMaJq3gVMhPcQHfft0HLSGVrVDgav9hQgcWp8ynjSFrGw
    ports:
      - 31020:31020
    volumes:
      - ~/ssl:/ssl

```

#### Non-SSL

> This example shows how to set up the app without ssl. This is useful for
> testing, but is **unsecure**, so don't expose the app to the outside
> world.

```yaml
---
version: '3'

services:
  app:
    image: timmo001/feedback-app
    restart: unless-stopped
    ports:
      - 80:80
  api:
    image: timmo001/feedback-api
    environment:
      - TOKEN=wvQYEK2JS7PPSUUVPosSkH8k9engHcRBhJmLFxBki614AtJcNHdU56NDEJpV6Yx5
    ports:
      - 31020:31020
```

### Docker

---

- Install [Docker](https://www.docker.com/community-edition)
- Run image

#### SSL

> This example maps the `ssl` directory in the home directory.
> Inside this directory are two files `fullchain.pem` and `privkey.pem`
> which are files generated by [Let's Encrypt](https://letsencrypt.org/).
> Change the `TOKEN` environment variable to your own generated token

```bash
docker run -d \
  -p 443:443 \
  -v ~/ssl:/ssl \
  timmo001/feedback-app
```

```bash
docker run -d \
  -p 31020:31020 \
  -v ~/ssl:/ssl \
  -e CERTIFICATES_DIR='/ssl' \
  -e TOKEN=kZizIjt1fduiVqA68RuvMaJq3gVMhPcQHfft0HLSGVrVDgav9hQgcWp8ynjSFrGw \
  timmo001/feedback-api
```

#### Non-SSL

> This example shows how to set up the app without ssl. This is useful for
> testing, but is **unsecure**, so don't expose the app to the outside
> world.

```bash
docker run -d \
  -p 80:80 \
  timmo001/feedback-app
```

```bash
docker run -d \
  -p 31020:31020 \
  -e TOKEN=wvQYEK2JS7PPSUUVPosSkH8k9engHcRBhJmLFxBki614AtJcNHdU56NDEJpV6Yx5 \
  timmo001/feedback-api
```

### Node JS

---

#### API Setup

- First clone the
  [Feedback API](feedback-api) repository
- Checkout the version you want via releases
- Change the token inside `.env` to a secure and random password. I used a
 generator like [this][token-gen] one.
- Install packages

```bash
yarn install
```

- Run

```bash
node index.js
```

#### Webapp

- Clone this repository
- Checkout the version you want via releases
- Install packages

```bash
yarn install
```

##### Production - SSL

- Build a production version

```bash
yarn build
```

- Install nginx
- Edit your server config `/etc/nginx/conf.d/default.conf`

```conf
server {
  listen 443 ssl http2 default_server;
  listen [::]:443 ssl http2 default_server;

  root /usr/share/nginx/html;
  index index.html;
  server_name 172.0.0.1;

  ssl_certificate /ssl/fullchain.pem;
  ssl_certificate_key /ssl/privkey.pem;

  location / {
    try_files $uri /index.html;
  }
}
```

- Copy the files in the build folder into nginx's html directory at
 `/usr/share/nginx/html`
- Start your server

```bash
nginx -g "daemon off;"
```

##### Production - Non-SSL

> **This option is not secure. Do not open to the outside world!**

- Build a production version

```bash
yarn build
```

- Install nginx
- Edit your server config `/etc/nginx/conf.d/default.conf`

```conf
server {
  listen 80 default_server;
  listen [::]:80 default_server;
  root /usr/share/nginx/html;
  index index.html;
  server_name 172.0.0.1;
  location / {
    try_files \$uri /index.html;
  }
}
```

- Copy the files in the build folder into nginx's html directory at
 `/usr/share/nginx/html`
- Start your server

```bash
nginx -g "daemon off;"
```

##### Development

> **This option is not secure. Do not open to the outside world!**

- Run the app

```bash
yarn start
```

- The app should open in your default browser under [http://localhost:3000](http://localhost:3000)

[feedback-api]: https://gitlab.com/timmo/feedback-api
[token-gen]: http://tools.andidittrich.de/Token.html
[aarch64-shield]: https://img.shields.io/badge/aarch64-yes-green.svg
[amd64-shield]: https://img.shields.io/badge/amd64-yes-green.svg
[armhf-shield]: https://img.shields.io/badge/armhf-yes-green.svg
[i386-shield]: https://img.shields.io/badge/i386-yes-green.svg
[dockerhub]: https://hub.docker.com/r/timmo001/feedback-app
[layers-shield]: https://images.microbadger.com/badges/image/timmo001/feedback-app.svg
[microbadger]: https://microbadger.com/images/timmo001/feedback-app
[pulls-shield]: https://img.shields.io/docker/pulls/timmo001/feedback-app.svg
[version-shield]: https://images.microbadger.com/badges/version/timmo001/feedback-app.svg
